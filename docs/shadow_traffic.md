# Shadow Traffic 가이드 (미러링 트래픽)

Shadow Traffic은 **실제 요청을 복제하여** 별도 경로로 전달하는 방법입니다.
운영 트래픽에 영향을 주지 않고 새 모델/새 버전의 성능을 검증하는 데 사용합니다.

---

## 1) 목표

- 실제 트래픽 기반 성능/정확도 검증
- 운영 영향 최소화 (응답은 본 경로만 사용)
- 장애 감지 시 즉시 중단 가능

---

## 2) 동작 방식

1. 클라이언트 요청 수신
2. 본 경로(primary)는 정상 처리 후 응답 반환
3. 동일 요청을 shadow 업스트림으로 **비동기 전송**
4. shadow 응답은 저장/분석만 하고 사용자에게는 반환하지 않음

---

## 3) 적용 위치

- **Gateway 단계**에서 복제 처리
- 라우팅 정책에 `shadow` 대상 정의

---

## 4) 기본 정책 (예시)

- 특정 모델 요청 중 5%만 shadow 전송
- shadow 대상은 별도 워커(또는 외부 엔진)로 구성

예시 정책(개념):
```
shadow:
  enabled: true
  percent: 5
  target: "shadow-model"
```

---

## 5) 안전장치

- shadow 대상 장애는 본 경로에 영향 없음
- shadow 요청 실패는 로그/메트릭으로만 기록
- 요청/trace ID는 그대로 전달

---

## 6) 관측 포인트

- shadow 전송 성공/실패 수
- shadow 응답 지연 시간
- shadow 결과와 primary 결과의 차이(오프라인 비교)

---

## 7) 체크리스트

- [ ] shadow 요청이 비동기 처리되는가?
- [ ] shadow 실패가 본 경로에 영향 없는가?
- [ ] shadow 요청/응답 로그가 분리되는가?
- [ ] 분석/비교를 위한 저장 경로가 있는가?
