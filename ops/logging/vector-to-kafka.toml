data_dir = "/vector-data-dir"

[sources.docker_logs]
type = "docker_logs"
include_labels = ["com.docker.compose.service=gateway"]

[transforms.normalize]
type = "remap"
inputs = ["docker_logs"]
source = '''
container = .container_name
ts = .timestamp
parsed, err = parse_json(.message)
if err == null && is_object(parsed) {
  . = parsed
} else {
  . = {"message": .message}
}
.container_name = container
.timestamp = ts
'''

[sinks.kafka]
type = "kafka"
inputs = ["normalize"]
bootstrap_servers = "kafka:9092"
topic = "gateway-logs"
encoding.codec = "json"
